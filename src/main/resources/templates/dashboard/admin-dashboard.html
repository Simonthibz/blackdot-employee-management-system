<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Blackdot EMS</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header -->
    <div th:replace="~{layout/admin-layout :: header}"></div>

    <!-- Sidebar Navigation -->
    <div th:replace="~{layout/admin-layout :: sidebar('dashboard')}"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title">Organizational Analytics</h1>
                <p class="dashboard-subtitle">Real-time insights and performance metrics for <span th:text="${stats.currentQuarter} + ' ' + ${stats.currentYear}">Q4 2025</span></p>
            </div>
            <div class="header-actions">
                <select class="period-selector">
                    <option selected>This Quarter</option>
                    <option>This Month</option>
                    <option>This Year</option>
                    <option>All Time</option>
                </select>
            </div>
        </div>

        <!-- Primary KPI Cards -->
        <div class="kpi-grid">
            <!-- Total Assessments -->
            <div class="kpi-card">
                <div class="kpi-content">
                    <div class="kpi-header">
                        <span class="kpi-label">Total Assessments</span>
                        <span class="kpi-badge badge-blue">
                            <i class="fas fa-clipboard-check"></i>
                        </span>
                    </div>
                    <div class="kpi-value" th:text="${stats.activeAssessments}">0</div>
                    <div class="kpi-footer">
                        <div class="kpi-progress">
                            <div class="progress-bar-mini">
                                <div class="progress-fill-mini success" th:style="'width: ' + ${stats.passRate} + '%'"></div>
                            </div>
                            <span class="kpi-trend success">
                                <i class="fas fa-arrow-up"></i> <span th:text="${stats.passRate} + '%'">0%</span> pass rate
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Completed Tasks -->
            <div class="kpi-card">
                <div class="kpi-content">
                    <div class="kpi-header">
                        <span class="kpi-label">Completed Tasks</span>
                        <span class="kpi-badge badge-green">
                            <i class="fas fa-check-circle"></i>
                        </span>
                    </div>
                    <div class="kpi-value" th:text="${stats.completedTasks}">0</div>
                    <div class="kpi-footer">
                        <div class="kpi-progress">
                            <div class="progress-bar-mini">
                                <div class="progress-fill-mini success" th:style="'width: ' + ${stats.taskCompletionRate} + '%'"></div>
                            </div>
                            <span class="kpi-trend success">
                                <i class="fas fa-arrow-up"></i> <span th:text="${stats.taskCompletionRate} + '%'">0%</span> completion
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Departments -->
            <div class="kpi-card">
                <div class="kpi-content">
                    <div class="kpi-header">
                        <span class="kpi-label">Active Departments</span>
                        <span class="kpi-badge badge-purple">
                            <i class="fas fa-building"></i>
                        </span>
                    </div>
                    <div class="kpi-value" th:text="${stats.activeDepartments}">0</div>
                    <div class="kpi-footer">
                        <div class="kpi-progress">
                            <span class="kpi-detail">
                                <i class="fas fa-users"></i> All operational
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Employees -->
            <div class="kpi-card">
                <div class="kpi-content">
                    <div class="kpi-header">
                        <span class="kpi-label">Active Employees</span>
                        <span class="kpi-badge badge-orange">
                            <i class="fas fa-user-friends"></i>
                        </span>
                    </div>
                    <div class="kpi-value" th:text="${stats.totalEmployees}">0</div>
                    <div class="kpi-footer">
                        <div class="kpi-progress">
                            <span class="kpi-detail">
                                <i class="fas fa-chart-line"></i> Workforce strength
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Overview Section -->
        <div class="analytics-grid">
            <!-- Assessment Performance -->
            <div class="analytics-card">
                <div class="card-header-clean">
                    <h3 class="card-title-clean">
                        <i class="fas fa-chart-pie"></i> Assessment Performance
                    </h3>
                    <span class="card-subtitle-clean">Quarterly Overview</span>
                </div>
                <div class="analytics-body">
                    <!-- Circular Progress Indicators -->
                    <div class="circular-stats">
                        <div class="circular-stat">
                            <div class="circular-progress" data-percent="75">
                                <svg class="circular-chart" viewBox="0 0 36 36">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <path class="circle success-circle" stroke-dasharray="75, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                    <text x="18" y="20.5" class="circular-text" th:text="${stats.passRate}">75</text>
                                    <text x="18" y="24" class="circular-unit">%</text>
                                </svg>
                            </div>
                            <span class="circular-label">Pass Rate</span>
                        </div>
                        
                        <div class="circular-stat">
                            <div class="score-display">
                                <div class="score-number" th:text="${stats.quarterlyPassed}">0</div>
                                <div class="score-label">Passed</div>
                            </div>
                        </div>
                        
                        <div class="circular-stat">
                            <div class="score-display">
                                <div class="score-number warning-text" th:text="${stats.quarterlyFailed}">0</div>
                                <div class="score-label">Failed</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Bars -->
                    <div class="progress-section">
                        <div class="progress-item">
                            <div class="progress-header">
                                <span class="progress-label">Completed Assessments</span>
                                <span class="progress-value" th:text="${stats.quarterlyPassed + stats.quarterlyFailed} + '/' + ${stats.quarterlyPassed + stats.quarterlyFailed + stats.incompleteAssessments}">0/0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill success" 
                                     th:style="'width: ' + (${stats.quarterlyPassed + stats.quarterlyFailed} * 100.0 / (${stats.quarterlyPassed + stats.quarterlyFailed + stats.incompleteAssessments} > 0 ? ${stats.quarterlyPassed + stats.quarterlyFailed + stats.incompleteAssessments} : 1)) + '%'"></div>
                            </div>
                        </div>
                        
                        <div class="progress-item">
                            <div class="progress-header">
                                <span class="progress-label">Pending Reviews</span>
                                <span class="progress-value" th:text="${stats.incompleteAssessments}">0</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill warning" 
                                     th:style="'width: ' + (${stats.incompleteAssessments} * 100.0 / (${stats.quarterlyPassed + stats.quarterlyFailed + stats.incompleteAssessments} > 0 ? ${stats.quarterlyPassed + stats.quarterlyFailed + stats.incompleteAssessments} : 1)) + '%'"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Task Management Overview -->
            <div class="analytics-card">
                <div class="card-header-clean">
                    <h3 class="card-title-clean">
                        <i class="fas fa-tasks"></i> Task Management
                    </h3>
                    <span class="card-subtitle-clean">Current Status</span>
                </div>
                <div class="analytics-body">
                    <!-- Task Status Breakdown -->
                    <div class="task-breakdown">
                        <div class="task-stat-item">
                            <div class="task-stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="task-stat-details">
                                <div class="task-stat-value" th:text="${stats.pendingTasks}">0</div>
                                <div class="task-stat-label">Pending</div>
                            </div>
                        </div>
                        
                        <div class="task-stat-item">
                            <div class="task-stat-icon progress">
                                <i class="fas fa-spinner"></i>
                            </div>
                            <div class="task-stat-details">
                                <div class="task-stat-value" th:text="${stats.inProgressTasks}">0</div>
                                <div class="task-stat-label">In Progress</div>
                            </div>
                        </div>
                        
                        <div class="task-stat-item">
                            <div class="task-stat-icon completed">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="task-stat-details">
                                <div class="task-stat-value" th:text="${stats.completedTasks}">0</div>
                                <div class="task-stat-label">Completed</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Overdue Alert -->
                    <div class="alert-box" th:if="${stats.overdueTasks > 0}">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Attention Required</div>
                            <div class="alert-message">
                                <span th:text="${stats.overdueTasks}">0</span> task<span th:if="${stats.overdueTasks > 1}">s</span> overdue. Immediate action needed.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Task Completion Progress -->
                    <div class="progress-section">
                        <div class="progress-item">
                            <div class="progress-header">
                                <span class="progress-label">Overall Completion</span>
                                <span class="progress-value" th:text="${stats.taskCompletionRate} + '%'">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" 
                                     th:classappend="${stats.taskCompletionRate >= 80} ? 'success' : (${stats.taskCompletionRate >= 50} ? 'warning' : 'danger')"
                                     th:style="'width: ' + ${stats.taskCompletionRate} + '%'"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
            <div class="chart-card">
                <div class="card-header-clean">
                    <h3 class="card-title-clean">
                        <i class="fas fa-chart-area"></i> Assessment Trends
                    </h3>
                    <span class="card-subtitle-clean">Performance Distribution</span>
                </div>
                <div class="chart-body">
                    <canvas id="assessmentChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="card-header-clean">
                    <h3 class="card-title-clean">
                        <i class="fas fa-chart-bar"></i> Task Distribution
                    </h3>
                    <span class="card-subtitle-clean">By Status</span>
                </div>
                <div class="chart-body">
                    <canvas id="taskChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Department & Employee Insights -->
        <div class="insights-grid">
            <!-- Department Performance -->
            <div class="insight-card">
                <div class="card-header-clean">
                    <h3 class="card-title-clean">
                        <i class="fas fa-building"></i> Department Performance
                    </h3>
                </div>
                <div class="insight-body">
                    <div class="department-metrics">
                        <div class="dept-metric">
                            <div class="dept-icon">
                                <i class="fas fa-users-cog"></i>
                            </div>
                            <div class="dept-info">
                                <div class="dept-value" th:text="${stats.activeDepartments}">0</div>
                                <div class="dept-label">Active Departments</div>
                            </div>
                            <div class="dept-badge">
                                <span class="status-badge success">100%</span>
                            </div>
                        </div>
                        
                        <div class="dept-metric">
                            <div class="dept-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="dept-info">
                                <div class="dept-value">High</div>
                                <div class="dept-label">Overall Performance</div>
                            </div>
                            <div class="dept-badge">
                                <span class="status-badge success">
                                    <i class="fas fa-arrow-up"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employee Engagement -->
            <div class="insight-card">
                <div class="card-header-clean">
                    <h3 class="card-title-clean">
                        <i class="fas fa-user-check"></i> Employee Engagement
                    </h3>
                </div>
                <div class="insight-body">
                    <div class="employee-metrics">
                        <div class="emp-metric">
                            <div class="emp-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="emp-info">
                                <div class="emp-value" th:text="${stats.totalEmployees}">0</div>
                                <div class="emp-label">Active Employees</div>
                            </div>
                        </div>
                        
                        <div class="emp-metric">
                            <div class="emp-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="emp-info">
                                <div class="emp-value" th:text="${stats.quarterlyPassed}">0</div>
                                <div class="emp-label">Top Performers</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Overview Table -->
        <div class="data-table-card">
            <div class="card-header-clean">
                <h3 class="card-title-clean">
                    <i class="fas fa-server"></i> System Health Metrics
                </h3>
            </div>
            <div class="table-wrapper">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-chart-bar"></i> Metric
                                </div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-calculator"></i> Value
                                </div>
                            </th>
                            <th>
                                <div class="th-content">
                                    <i class="fas fa-signal"></i> Status
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <div class="metric-name">
                                    <span class="metric-icon blue">
                                        <i class="fas fa-users"></i>
                                    </span>
                                    Active Employees
                                </div>
                            </td>
                            <td>
                                <span class="value-badge" th:text="${stats.totalEmployees}">0</span>
                            </td>
                            <td>
                                <span class="status-pill success">
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="metric-name">
                                    <span class="metric-icon purple">
                                        <i class="fas fa-building"></i>
                                    </span>
                                    Active Departments
                                </div>
                            </td>
                            <td>
                                <span class="value-badge" th:text="${stats.activeDepartments}">0</span>
                            </td>
                            <td>
                                <span class="status-pill success">
                                    <i class="fas fa-check-circle"></i> Operational
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="metric-name">
                                    <span class="metric-icon teal">
                                        <i class="fas fa-clipboard-list"></i>
                                    </span>
                                    Active Assessments
                                </div>
                            </td>
                            <td>
                                <span class="value-badge" th:text="${stats.activeAssessments}">0</span>
                            </td>
                            <td>
                                <span class="status-pill success">
                                    <i class="fas fa-play-circle"></i> Running
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="metric-name">
                                    <span class="metric-icon green">
                                        <i class="fas fa-percentage"></i>
                                    </span>
                                    Overall Pass Rate
                                </div>
                            </td>
                            <td>
                                <span class="value-badge" th:text="${stats.passRate} + '%'">0%</span>
                            </td>
                            <td>
                                <span th:class="${stats.passRate >= 80} ? 'status-pill success' : (${stats.passRate >= 60} ? 'status-pill warning' : 'status-pill danger')">
                                    <i th:class="${stats.passRate >= 80} ? 'fas fa-star' : (${stats.passRate >= 60} ? 'fas fa-exclamation-triangle' : 'fas fa-times-circle')"></i>
                                    <span th:text="${stats.passRate >= 80} ? 'Excellent' : (${stats.passRate >= 60} ? 'Good' : 'Needs Attention')">Status</span>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="metric-name">
                                    <span class="metric-icon orange">
                                        <i class="fas fa-tasks"></i>
                                    </span>
                                    Task Completion Rate
                                </div>
                            </td>
                            <td>
                                <span class="value-badge" th:text="${stats.taskCompletionRate} + '%'">0%</span>
                            </td>
                            <td>
                                <span th:class="${stats.taskCompletionRate >= 80} ? 'status-pill success' : (${stats.taskCompletionRate >= 50} ? 'status-pill warning' : 'status-pill danger')">
                                    <i th:class="${stats.taskCompletionRate >= 80} ? 'fas fa-star' : (${stats.taskCompletionRate >= 50} ? 'fas fa-exclamation-triangle' : 'fas fa-times-circle')"></i>
                                    <span th:text="${stats.taskCompletionRate >= 80} ? 'Excellent' : (${stats.taskCompletionRate >= 50} ? 'Good' : 'Needs Improvement')">Status</span>
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="metric-name">
                                    <span th:class="${stats.overdueTasks > 0} ? 'metric-icon red' : 'metric-icon green'">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </span>
                                    Overdue Tasks
                                </div>
                            </td>
                            <td>
                                <span class="value-badge" th:classappend="${stats.overdueTasks > 0} ? 'danger' : ''" th:text="${stats.overdueTasks}">0</span>
                            </td>
                            <td>
                                <span th:class="${stats.overdueTasks == 0} ? 'status-pill success' : (${stats.overdueTasks <= 3} ? 'status-pill warning' : 'status-pill danger')">
                                    <i th:class="${stats.overdueTasks == 0} ? 'fas fa-check-circle' : (${stats.overdueTasks <= 3} ? 'fas fa-exclamation-triangle' : 'fas fa-times-circle')"></i>
                                    <span th:text="${stats.overdueTasks == 0} ? 'None' : (${stats.overdueTasks <= 3} ? 'Monitor' : 'Urgent')">Status</span>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Common Scripts -->
    <div th:replace="~{layout/admin-layout :: common-scripts}"></div>

    <script>
        // Assessment Performance Doughnut Chart
        const assessmentCtx = document.getElementById('assessmentChart').getContext('2d');
        const assessmentChart = new Chart(assessmentCtx, {
            type: 'doughnut',
            data: {
                labels: ['Passed', 'Failed', 'Pending'],
                datasets: [{
                    data: [
                        /*[[${stats.quarterlyPassed}]]*/ 0, 
                        /*[[${stats.quarterlyFailed}]]*/ 0,
                        /*[[${stats.incompleteAssessments}]]*/ 0
                    ],
                    backgroundColor: ['#27ae60', '#e74c3c', '#f39c12'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 10,
                            font: {
                                size: 11
                            }
                        }
                    }
                }
            }
        });

        // Task Status Bar Chart
        const taskCtx = document.getElementById('taskChart').getContext('2d');
        const taskChart = new Chart(taskCtx, {
            type: 'bar',
            data: {
                labels: ['Pending', 'In Progress', 'Completed', 'Overdue'],
                datasets: [{
                    label: 'Tasks',
                    data: [
                        /*[[${stats.pendingTasks}]]*/ 0, 
                        /*[[${stats.inProgressTasks}]]*/ 0, 
                        /*[[${stats.completedTasks}]]*/ 0, 
                        /*[[${stats.overdueTasks}]]*/ 0
                    ],
                    backgroundColor: ['#f39c12', '#3498db', '#27ae60', '#e74c3c'],
                    borderWidth: 0,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                aspectRatio: 2,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1,
                            font: {
                                size: 11
                            }
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                size: 11
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>