<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Role Management - Blackdot EMS</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/css/roles.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <div th:replace="~{layout/admin-layout :: header}"></div>

    <!-- Sidebar Navigation -->
    <div th:replace="~{layout/admin-layout :: sidebar('roles')}"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-header-content">
                <div>
                    <h2 class="page-title">Role Management</h2>
                    <p class="page-subtitle">Manage user roles and permissions</p>
                </div>
            </div>
            <button onclick="showCreateRoleModal()" class="btn btn-primary" th:if="${canManageRoles}">
                <i class="fas fa-plus"></i> Create Custom Role
            </button>
        </div>

        <!-- View Buttons -->
        <div class="view-buttons" th:if="${canManageRoles}">
            <button onclick="loadAllRoles()" class="btn btn-secondary">
                <i class="fas fa-list"></i> All Roles
            </button>
            <button onclick="loadSystemRoles()" class="btn btn-secondary">
                <i class="fas fa-shield-alt"></i> System Roles
            </button>
            <button onclick="loadCustomRoles()" class="btn btn-secondary">
                <i class="fas fa-user-cog"></i> Custom Roles
            </button>
        </div>

        <!-- Roles Table Card -->
        <div class="card">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Display Name</th>
                            <th>System Name</th>
                            <th>Type</th>
                            <th>Users</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="rolesTableBody">
                        <tr>
                            <td colspan="7" class="text-center">Loading roles...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Create/Edit Role Modal -->
    <div id="roleModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle"><i class="fas fa-user-shield"></i> Create Role</h3>
                <button class="modal-close" onclick="closeRoleModal()" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="roleForm" onsubmit="saveRole(event)">
                    <input type="hidden" id="roleId">
                    <input type="hidden" id="isSystemRole">
                    
                    <!-- System Role Selection (only for new custom roles) -->
                    <div id="roleTypeSection" class="form-group">
                        <label class="form-label">Role Type</label>
                        <div style="display: flex; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="roleType" value="custom" checked onchange="handleRoleTypeChange()">
                                <span>Custom Role</span>
                            </label>
                        </div>
                        <small class="form-text">Custom roles can be fully customized with specific permissions</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="displayName" class="form-label">Role Name <span class="text-danger">*</span></label>
                        <input type="text" id="displayName" class="form-control" required>
                        <small class="form-text">Enter a descriptive name for this role (e.g., "Sales Manager", "IT Support")</small>
                    </div>

                    <div class="form-group">
                        <label for="description" class="form-label">Description</label>
                        <textarea id="description" class="form-control" rows="3" placeholder="Describe the purpose and responsibilities of this role"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Permissions <span class="text-danger">*</span>
                            <button type="button" onclick="toggleAllPermissions()" class="btn btn-sm" style="margin-left: 1rem; padding: 0.25rem 0.5rem; font-size: 0.75rem;">
                                <i class="fas fa-check-double"></i> Select All
                            </button>
                        </label>
                        <div id="permissionsContainer" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 6px; padding: 1rem;">
                            <p class="text-center" style="color: #6c757d;">Loading permissions...</p>
                        </div>
                        <small class="form-text">Select the permissions this role should have</small>
                    </div>

                    <div class="form-group">
                        <label for="priority" class="form-label">Priority</label>
                        <input type="number" id="priority" class="form-control" min="1" max="100" value="50">
                        <small class="form-text">Higher number = higher priority (1-100)</small>
                    </div>

                    <div class="form-group" id="statusGroup" style="display: none;">
                        <label for="isActive" class="form-label">Status</label>
                        <select id="isActive" class="form-control">
                            <option value="true">Active</option>
                            <option value="false">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeRoleModal()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" onclick="saveRole(event)" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Role
                </button>
            </div>
        </div>
    </div>

    <!-- View Role Modal -->
    <div id="viewRoleModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> Role Details</h3>
                <button class="modal-close" onclick="closeViewRoleModal()" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Display Name:</label>
                    <p id="viewDisplayName" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">System Name:</label>
                    <p id="viewName" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">Type:</label>
                    <p id="viewType" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">Description:</label>
                    <p id="viewDescription" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">Permissions:</label>
                    <p id="viewPermissions" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">Priority:</label>
                    <p id="viewPriority" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">User Count:</label>
                    <p id="viewUserCount" class="view-value"></p>
                </div>
                <div class="form-group">
                    <label class="form-label">Status:</label>
                    <p id="viewStatus" class="view-value"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="closeViewRoleModal()" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Common Scripts -->
    <div th:replace="~{layout/admin-layout :: common-scripts}"></div>
    
    <!-- Page Specific Scripts -->
    <script th:src="@{/js/roles.js}"></script>
</body>
</html>
