<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle != null} ? ${pageTitle} + ' - Blackdot EMS' : 'Blackdot EMS'">Blackdot EMS</title>
    <!-- Single CSS File - Everything in admin-pages.css -->
    <link rel="stylesheet" th:href="@{/css/admin-pages.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header Fragment -->
    <header class="header" th:fragment="header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle Sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-brand">
                <img th:src="@{/images/blackdotpc.jpeg}" alt="Blackdot" class="header-logo">
                <h1 class="header-title">Blackdot Portal</h1>
            </div>
        </div>
        <div class="header-right">
            <div class="header-notifications">
                <button class="notification-btn" onclick="toggleNotifications()" aria-label="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge">3</span>
                </button>
                <div class="notification-dropdown" id="notificationMenu">
                    <div class="notification-header">
                        <h4>Notifications</h4>
                        <a href="#" class="mark-all-read">Mark all as read</a>
                    </div>
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <div class="notification-icon blue">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">New task assigned</div>
                                <div class="notification-time">5 minutes ago</div>
                            </div>
                        </a>
                        <a href="#" class="notification-item unread">
                            <div class="notification-icon orange">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">Assessment due today</div>
                                <div class="notification-time">1 hour ago</div>
                            </div>
                        </a>
                        <a href="#" class="notification-item">
                            <div class="notification-icon green">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">Training completed</div>
                                <div class="notification-time">3 hours ago</div>
                            </div>
                        </a>
                    </div>
                    <div class="notification-footer">
                        <a th:href="@{/dashboard/notifications}">View all notifications</a>
                    </div>
                </div>
            </div>
            <div class="user-info" th:if="${user}">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" th:text="${user.firstName + ' ' + user.lastName}">User Name</span>
                    <span class="user-role" th:text="${#strings.replace(user.authorities[0].authority, 'ROLE_', '')}">Role</span>
                </div>
                <div class="dropdown">
                    <button class="dropdown-toggle" onclick="toggleUserMenu()" aria-label="User Menu">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="userMenu">
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-user"></i> Profile
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" onclick="logout()" class="dropdown-item text-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Navigation Fragment -->
    <nav class="sidebar" th:fragment="sidebar(activePage)" id="sidebar">
        <div class="sidebar-header">
            <h3>Navigation</h3>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a th:href="@{/dashboard}" class="nav-link" th:classappend="${activePage == 'dashboard'} ? 'active' : ''">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/employees}" class="nav-link" th:classappend="${activePage == 'employees'} ? 'active' : ''">
                    <i class="fas fa-users"></i>
                    <span>Employees</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/departments}" class="nav-link" th:classappend="${activePage == 'departments'} ? 'active' : ''">
                    <i class="fas fa-sitemap"></i>
                    <span>Departments</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/roles}" class="nav-link" th:classappend="${activePage == 'roles'} ? 'active' : ''">
                    <i class="fas fa-user-shield"></i>
                    <span>Roles</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/assessments}" class="nav-link" th:classappend="${activePage == 'assessments'} ? 'active' : ''">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Assessments</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/tasks}" class="nav-link" th:classappend="${activePage == 'tasks'} ? 'active' : ''">
                    <i class="fas fa-tasks"></i>
                    <span>Tasks</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/audit}" class="nav-link" th:classappend="${activePage == 'audit'} ? 'active' : ''">
                    <i class="fas fa-history"></i>
                    <span>Audit Trail</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/lifecycle}" class="nav-link" th:classappend="${activePage == 'lifecycle'} ? 'active' : ''">
                    <i class="fas fa-diagram-project"></i>
                    <span>Lifecycle</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/training}" class="nav-link" th:classappend="${activePage == 'training'} ? 'active' : ''">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Training</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/reports}" class="nav-link" th:classappend="${activePage == 'reports'} ? 'active' : ''">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/documents}" class="nav-link" th:classappend="${activePage == 'documents'} ? 'active' : ''">
                    <i class="fas fa-folder-open"></i>
                    <span>Documents</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/leave}" class="nav-link" th:classappend="${activePage == 'leave'} ? 'active' : ''">
                    <i class="fas fa-calendar-check"></i>
                    <span>Leave</span>
                </a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <p>&copy; 2025 Blackdot</p>
        </div>
    </nav>

    <!-- Common Scripts Fragment -->
    <th:block th:fragment="common-scripts">
        <script>
            // Get JWT token from localStorage
            function getToken() {
                return localStorage.getItem('jwtToken');
            }

            // Logout function
            function logout() {
                localStorage.removeItem('jwtToken');
                window.location.href = '/login';
            }

            // Toggle sidebar on mobile
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                
                if (sidebar) {
                    sidebar.classList.toggle('show');
                }
                
                // Create overlay if it doesn't exist
                if (!overlay && sidebar.classList.contains('show')) {
                    const newOverlay = document.createElement('div');
                    newOverlay.id = 'sidebarOverlay';
                    newOverlay.className = 'sidebar-overlay';
                    newOverlay.onclick = toggleSidebar;
                    document.body.appendChild(newOverlay);
                } else if (overlay && !sidebar.classList.contains('show')) {
                    overlay.remove();
                }
            }

            // Toggle user menu dropdown
            function toggleUserMenu() {
                const menu = document.getElementById('userMenu');
                if (menu) {
                    menu.classList.toggle('show');
                }
            }

            // Toggle notifications dropdown
            function toggleNotifications() {
                const menu = document.getElementById('notificationMenu');
                if (menu) {
                    if (menu.classList.contains('show')) {
                        menu.classList.remove('show');
                        setTimeout(() => {
                            menu.style.display = 'none';
                        }, 300);
                    } else {
                        menu.style.display = 'block';
                        setTimeout(() => {
                            menu.classList.add('show');
                        }, 10);
                    }
                }
            }

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('userMenu');
                const notificationMenu = document.getElementById('notificationMenu');
                const dropdown = event.target.closest('.dropdown');
                const notificationBtn = event.target.closest('.notification-btn');
                const notificationDropdown = event.target.closest('.notification-dropdown');
                
                if (!dropdown && userMenu && userMenu.classList.contains('show')) {
                    userMenu.classList.remove('show');
                }
                
                if (!notificationBtn && !notificationDropdown && notificationMenu && notificationMenu.classList.contains('show')) {
                    notificationMenu.classList.remove('show');
                    setTimeout(() => {
                        notificationMenu.style.display = 'none';
                    }, 300);
                }
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const toggle = event.target.closest('.sidebar-toggle');
                const sidebarElement = event.target.closest('.sidebar');
                
                if (!toggle && !sidebarElement && sidebar && sidebar.classList.contains('show')) {
                    toggleSidebar();
                }
            });
        </script>
    </th:block>
</body>
</html>
