<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle != null} ? ${pageTitle} + ' - Blackdot EMS' : 'Blackdot EMS'">Blackdot EMS</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header Fragment -->
    <header class="header" th:fragment="header">
        <div class="header-left">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle Sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-brand">
                <img th:src="@{/images/blackdotpc.jpeg}" alt="Blackdot" class="header-logo">
                <h1 class="header-title">Blackdot Portal</h1>
            </div>
        </div>
        <div class="header-right">
            <div class="user-info" th:if="${user}">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" th:text="${user.firstName + ' ' + user.lastName}">User Name</span>
                    <span class="user-role" th:text="${#strings.replace(user.authorities[0].authority, 'ROLE_', '')}">Role</span>
                </div>
                <div class="dropdown">
                    <button class="dropdown-toggle" onclick="toggleUserMenu()" aria-label="User Menu">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="userMenu">
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-user"></i> Profile
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" onclick="logout()" class="dropdown-item text-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Navigation Fragment -->
    <nav class="sidebar" th:fragment="sidebar(activePage)" id="sidebar">
        <div class="sidebar-header">
            <h3>Navigation</h3>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a th:href="@{/dashboard}" class="nav-link" th:classappend="${activePage == 'dashboard'} ? 'active' : ''">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/employees}" class="nav-link" th:classappend="${activePage == 'employees'} ? 'active' : ''">
                    <i class="fas fa-users"></i>
                    <span>Employees</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/departments}" class="nav-link" th:classappend="${activePage == 'departments'} ? 'active' : ''">
                    <i class="fas fa-sitemap"></i>
                    <span>Departments</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/roles}" class="nav-link" th:classappend="${activePage == 'roles'} ? 'active' : ''">
                    <i class="fas fa-user-shield"></i>
                    <span>Roles</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/assessments}" class="nav-link" th:classappend="${activePage == 'assessments'} ? 'active' : ''">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Assessments</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/tasks}" class="nav-link" th:classappend="${activePage == 'tasks'} ? 'active' : ''">
                    <i class="fas fa-tasks"></i>
                    <span>Tasks</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/audit}" class="nav-link" th:classappend="${activePage == 'audit'} ? 'active' : ''">
                    <i class="fas fa-history"></i>
                    <span>Audit Trail</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/lifecycle}" class="nav-link" th:classappend="${activePage == 'lifecycle'} ? 'active' : ''">
                    <i class="fas fa-diagram-project"></i>
                    <span>Lifecycle</span>
                </a>
            </li>
            <li class="nav-item">
                <a th:href="@{/dashboard/reports}" class="nav-link" th:classappend="${activePage == 'reports'} ? 'active' : ''">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
            </li>
        </ul>
        <div class="sidebar-footer">
            <p>&copy; 2025 Blackdot</p>
        </div>
    </nav>

    <!-- Common Scripts Fragment -->
    <th:block th:fragment="common-scripts">
        <script>
            // Get JWT token from localStorage
            function getToken() {
                return localStorage.getItem('jwtToken');
            }

            // Logout function
            function logout() {
                localStorage.removeItem('jwtToken');
                window.location.href = '/login';
            }

            // Toggle sidebar on mobile
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                
                if (sidebar) {
                    sidebar.classList.toggle('show');
                }
                
                // Create overlay if it doesn't exist
                if (!overlay && sidebar.classList.contains('show')) {
                    const newOverlay = document.createElement('div');
                    newOverlay.id = 'sidebarOverlay';
                    newOverlay.className = 'sidebar-overlay';
                    newOverlay.onclick = toggleSidebar;
                    document.body.appendChild(newOverlay);
                } else if (overlay && !sidebar.classList.contains('show')) {
                    overlay.remove();
                }
            }

            // Toggle user menu dropdown
            function toggleUserMenu() {
                const menu = document.getElementById('userMenu');
                if (menu) {
                    menu.classList.toggle('show');
                }
            }

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                const userMenu = document.getElementById('userMenu');
                const dropdown = event.target.closest('.dropdown');
                
                if (!dropdown && userMenu && userMenu.classList.contains('show')) {
                    userMenu.classList.remove('show');
                }
            });

            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const toggle = event.target.closest('.sidebar-toggle');
                const sidebarElement = event.target.closest('.sidebar');
                
                if (!toggle && !sidebarElement && sidebar && sidebar.classList.contains('show')) {
                    toggleSidebar();
                }
            });
        </script>
    </th:block>
</body>
</html>
